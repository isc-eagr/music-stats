<html xmlns:th="http://www.thymeleaf.org">

<head>
	<title th:text="${artist}" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.js'></script>
	<script src='/js/utils.js'></script>
	<script src="/js/table-sort.js"></script>
	<link rel="stylesheet" href="/css/global.css" />
</head>

<body>
	<header class="topbar">
		<div class="container">
			<nav class="breadcrumbs">
				<a href="/">Home</a>
				<span class="sep">/</span>
				<span th:text="${artist}"></span>
			</nav>
			<h1 class="page-title" th:text="${artist}"></h1>
		</div>
	</header>

	<main class="container">
		<section class="filters">
			<div class="filters__form">
				<label class="field">
					<span>Include Features</span>
					<input type="checkbox" th:checked="${includeFeatures}" th:onclick="window.location=[[${'/artist?artist='+artist+'&includeFeatures='}]]+this.checked"/>
				</label>
			</div>
		</section>

		<section class="cards-grid">
			<div class="card">
				<h3>Number Of Songs</h3>
				<div class="metric" th:text="${artistInfo.numberOfSongs}"></div>
			</div>
			<div class="card">
				<h3>Total Plays</h3>
				<div class="metric">
					<div class="tooltip">[[${artistInfo.totalPlays}]]
						<span class="tooltiptext" th:text="${artistInfo.playsByAccount}"/>
					</div>
				</div>
			</div>
			<div class="card">
				<h3>Total Playtime</h3>
				<div class="metric" th:text="${artistInfo.totalPlaytime}"></div>
			</div>
			<div class="card">
				<h3>First Song Played</h3>
				<div class="metric" th:text="${artistInfo.firstSongPlayed}"></div>
			</div>
			<div class="card">
				<h3>Last Song Played</h3>
				<div class="metric" th:text="${artistInfo.lastSongPlayed}"></div>
			</div>
			<div class="card">
				<h3>Average Song Length</h3>
				<div class="metric" th:text="${artistInfo.averageSongLength}"></div>
			</div>
			<div class="card">
				<h3>Average Plays per Song</h3>
				<div class="metric" th:text="${#numbers.formatDecimal(artistInfo.averagePlaysPerSong, 1, 'DEFAULT', 2, 'DEFAULT')}"></div>
			</div>
			<div class="card">
				<h3>Activity Span</h3>
				<ul class="list-compact">
					<li>Days played: <strong th:text="${artistInfo.daysArtistWasPlayed}"></strong></li>
					<li>Weeks played: <strong th:text="${artistInfo.weeksArtistWasPlayed}"></strong></li>
					<li>Months played: <strong th:text="${artistInfo.monthsArtistWasPlayed}"></strong></li>
				</ul>
			</div>
		</section>

		<section class="data-section">
			<h2 class="section-title">Milestones</h2>
			<div class="table-wrapper">
				<table id="milestonesTable" class="table table-compact js-sortable">
					<thead>
						<tr>
							<th>Milestone</th>
							<th>Date</th>
							<th>Days it took to achieve it</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="milestone : ${artistInfo.milestones}">
							<td th:text="${milestone.plays}"></td>
							<td th:text="${milestone.date}"></td>
							<td th:text="${milestone.days}"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</section>

		<section class="data-section">
			<h2 class="section-title">Albums</h2>
			<div class="table-wrapper">
				<table id="albumsTable" class="table table-compact js-sortable">
					<thead>
						<tr>
							<th>Position</th>
							<th>Artist</th>
							<th>Album</th>
							<th>Release Year</th>
							<th>Number of Tracks in Library</th>
							<th>Total Plays</th>
							<th>Album Length</th>
							<th>Total Playtime</th>
							<th>First Play</th>
							<th>Last Play</th>
							<th>Average Song Length</th>
							<th>Average Plays Per Song</th>
							<th>Days album was played</th>
							<th>Weeks album was played</th>
							<th>Months album was played</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="album, stat : ${artistInfo.albums}">
							<td th:text="${stat.index+1}"></td>
							<td th:style="${album.artist != artist ? 'background-color:#B1F2FF' :''}"><a th:href="@{/artist?artist={artist}(artist=${album.artist})}" th:text="${album.artist}"></a></td>
							<td th:style="${album.artist != artist ? 'background-color:#B1F2FF' :''}"><a th:href="@{/album?artist={artist}&album={album}(artist=${artist},album=${album.album})}"
									th:text="${album.album}"></a></td>
							<td><a th:href="@{/category/100/{category}/{value}(value=${album.releaseYear},category=${'Year'})}"
									th:text="${album.releaseYear}"></a></td>
							<td th:text="${album.numberOfTracks}"></td>
							<td th:attr="data-sort-value=${album.totalPlays}">
								<div class="tooltip">[[${album.totalPlays}]]
								  <span class="tooltiptext" th:text="${album.playsByAccount}"/>
								</div>
							</td>
							<td th:text="${album.albumLengthString}" th:data-value="${album.albumLength}" th:attr="data-sort-value=${album.albumLength}"></td>
							<td th:text="${album.totalPlaytimeString}" th:data-value="${album.totalPlaytime}" th:attr="data-sort-value=${album.totalPlaytime}"></td>
							<td th:text="${album.firstPlay}"></td>
							<td th:text="${album.lastPlay}"></td>
							<td th:text="${album.averageSongLengthString}" th:data-value="${album.averageSongLength}" th:attr="data-sort-value=${album.averageSongLength}"></td>
							<td th:text="${#numbers.formatDecimal(album.averagePlaysPerSong, 1, 'DEFAULT', 2, 'DEFAULT')}"></td>
							<td th:text="${album.daysAlbumWasPlayed}"></td>
							<td th:text="${album.weeksAlbumWasPlayed}"></td>
							<td th:text="${album.monthsAlbumWasPlayed}"></td>
						</tr>
					</tbody>
				</table>
			</div>
		</section>

		<section class="data-section">
			<h2 class="section-title">Songs</h2>
			<div class="table-wrapper">
				<table id="songsTable" class="table table-compact js-sortable">
					<thead>
						<tr>
							<th>Position</th>
							<th>Artist</th>
							<th>Song</th>
							<th>Album</th>
							<th>Release Year</th>
							<th>Total Plays</th>
							<th>Track Length</th>
							<th>Total Playtime</th>
							<th>First Play</th>
							<th>Last Play</th>
							<th>Days song was played</th>
							<th>Weeks song was played</th>
							<th>Months song was played</th>
							<th>Delete Song</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="song, stat : ${artistInfo.songs}">
							<td th:text="${stat.index+1}" th:style="${song.cloudStatus=='Deleted' ? 'background-color:#FFCCCC' : ''}"></td>
							<td th:style="${song.mainOrFeature=='Feature' ? 'background-color:#B1F2FF' :''}"><a th:href="@{/artist?artist={artist}(artist=${song.artist})}" th:text="${song.artist}"></a></td>
							<td th:style="${song.mainOrFeature=='Feature' ? 'background-color:#B1F2FF' :''}">
								<a th:href="@{/song?artist={artist}&album={album}&song={song}(artist=${artist},album=${song.album},song=${song.song})}"
									th:text="${song.song}"></a></td>
							<td><a th:href="@{/album?artist={artist}&album={album}(artist=${artist},album=${song.album})}"
									th:text="${song.album}"></a></td>
							<td><a th:href="@{/category/100/{category}/{value}(value=${song.releaseYear},category=${'Year'})}"
									th:text="${song.releaseYear}"></a></td>
							<td th:attr="data-sort-value=${song.totalPlays}">
								<div class="tooltip">[[${song.totalPlays}]]
								  <span class="tooltiptext" th:text="${song.playsByAccount}"/>
								</div>
							</td>
							<td th:text="${song.trackLengthString}" th:data-value="${song.trackLength}" th:attr="data-sort-value=${song.trackLength}"></td>
							<td th:text="${song.totalPlaytimeString}" th:data-value="${song.totalPlaytime}" th:attr="data-sort-value=${song.totalPlaytime}"></td>
							<td th:text="${song.firstPlay}"></td>
							<td th:text="${song.lastPlay}"></td>
							<td th:text="${song.daysSongWasPlayed}"></td>
							<td th:text="${song.weeksSongWasPlayed}"></td>
							<td th:text="${song.monthsSongWasPlayed}"></td>
							<td th:if="${song.cloudStatus=='Deleted'}">
								<a th:href="@{/softUndeleteSong/{id}(id=${song.id})}">Undelete Song</a>
							</td>
							<td th:if="${song.cloudStatus!='Deleted'}">
								<a th:href="@{/softDeleteSong/{id}(id=${song.id})}">Delete Song</a>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</section>

		<section class="chart-card" style="height:300px;">
			<canvas th:id="${'plays'}"></canvas>
			<script th:inline="javascript">
				/*<![CDATA[*/
				var ctx = document.getElementById(/*[[${'plays'}]]*/'').getContext('2d');
				var myChart = new Chart(ctx, {
					type: 'line',
					data: {
						labels: [ /*[(${chartLabels})]*/ ],
						datasets: [
							{
								label: 'Plays',
								data: [ /*[(${chartData})]*/ ],
								fill: false,
								borderColor: 'rgba(51, 86, 170, 0.9)',
     							tension: 0.1
							}
						]
					},
					options: { responsive: true }
				});
				myChart.update();
				/*]]>*/
			</script>
		</section>
	</main>

</body>

</html>