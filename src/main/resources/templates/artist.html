<html xmlns:th="http://www.thymeleaf.org">
<head>
	<title th:text="${artist}"/>
	<script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.js'></script>
	<script src='../js/utils.js'></script>
	<script src="../js/sortable.min.js"></script>
	<link rel="stylesheet" href="../css/sortable-theme-finder.css"/>
	<script type="text/javascript">
         
        var labelsArray=[];
        var plays=[];
        var percentagesPlays=[];
        var playtime=[];
        var percentagesPlaytime=[];
        
        var releaseLabelsArray=[];
		var releaseSongs=[];
		var releasePercentagesSongs=[];
		var releasePlays=[];
		var releasePercentagesPlays=[];
		var releasePlaytime=[];
		var releasePercentagesPlaytime=[];
          
		window.onload = function(){
			Sortable.init();
		}
	</script>
</head>
<body>

Number Of Songs: <span th:text="${artistInfo.numberOfSongs}"/> <br/>
Total Plays: <span th:text="${artistInfo.totalPlays}"/><br/>
Total Playtime: <span th:text="${artistInfo.totalPlaytime}"/><br/>
First Song Played: <span th:text="${artistInfo.firstSongPlayed}"/><br/>
Last Song Played: <span th:text="${artistInfo.lastSongPlayed}"/><br/>
Average Song Length: <span th:text="${artistInfo.averageSongLength}"/><br/>
Average Plays Per Song: <span th:text="${#numbers.formatDecimal(artistInfo.averagePlaysPerSong, 1, 'DEFAULT', 2, 'DEFAULT')}"/><br/>
Days artist was played: <span th:text="${artistInfo.daysArtistWasPlayed}"/><br/>
Weeks artist was played: <span th:text="${artistInfo.weeksArtistWasPlayed}"/><br/>
Months artist was played: <span th:text="${artistInfo.monthsArtistWasPlayed}"/><br/>

<table id="artistTable" class="sortable-theme-finder" data-sortable>
	<thead>
		<tr>
			<th>Position</th>
			<th>Album</th>
			<th>Release Year</th>
			<th>Number of Tracks in Library</th>
			<th>Total Plays</th>
			<th>Album Length</th>
			<th>Total Playtime</th>
			<th>First Play</th>
			<th>Last Play</th>
			<th>Average Song Length</th>
			<th>Average Plays Per Song</th>
			<th>Days album was played</th>
			<th>Weeks album was played</th>
			<th>Months album was played</th>
		</tr>
	</thead>
	<tbody>
		<tr th:each="album, stat : ${artistInfo.albums}">
			<td th:text="${stat.index+1}"/>
			<td><a th:href="@{/album?artist={artist}&album={album}(artist=${artist},album=${album.album})}" th:text="${album.album}"></td>
			<td><a th:href="@{/category?category={category}&value={value}(value=${album.releaseYear},category=${'year'})}" th:text="${album.releaseYear}"/></td>
			<td th:text="${album.numberOfTracks}"/>
			<td th:text="${album.totalPlays}"/>
			<td th:text="${album.albumLengthString}" th:data-value="${album.albumLength}"/>
			<td th:text="${album.totalPlaytimeString}" th:data-value="${album.totalPlaytime}"/>
			<td th:text="${album.firstPlay}"/>
			<td th:text="${album.lastPlay}"/>
			<td th:text="${album.averageSongLengthString}" th:data-value="${album.averageSongLength}"/>
			<td th:text="${#numbers.formatDecimal(album.averagePlaysPerSong, 1, 'DEFAULT', 2, 'DEFAULT')}"/>
			<td th:text="${album.daysAlbumWasPlayed}"/>
			<td th:text="${album.weeksAlbumWasPlayed}"/>
			<td th:text="${album.monthsAlbumWasPlayed}"/>
		</tr>
	</tbody>
</table>

<br/>
<br/>
<table id="artistTable" class="sortable-theme-finder" data-sortable>
	<thead>
		<tr>
			<th>Position</th>
			<th>Song</th>
			<th>Album</th>
			<th>Release Year</th>
			<th>Total Plays</th>
			<th>Track Length</th>
			<th>Total Playtime</th>
			<th>First Play</th>
			<th>Last Play</th>
			<th>Days song was played</th>
			<th>Weeks song was played</th>
			<th>Months song was played</th>
		</tr>
	</thead>
	<tbody>
		<tr th:each="song, stat : ${artistInfo.songs}">
			<td th:text="${stat.index+1}"/>
			<td><a th:href="@{/song?artist={artist}&album={album}&song={song}(artist=${artist},album=${song.album},song=${song.song})}" th:text="${song.song}"></td>
			<td><a th:href="@{/album?artist={artist}&album={album}(artist=${artist},album=${song.album})}" th:text="${song.album}"></td>
			<td><a th:href="@{/category?category={category}&value={value}(value=${song.releaseYear},category=${'year'})}" th:text="${song.releaseYear}"/></td>
			<td th:text="${song.totalPlays}"/>
			<td th:text="${song.trackLengthString}" th:data-value="${song.trackLength}"/>
			<td th:text="${song.totalPlaytimeString}" th:data-value="${song.totalPlaytime}"/>
			<td th:text="${song.firstPlay}"/>
			<td th:text="${song.lastPlay}"/>
			<td th:text="${song.daysSongWasPlayed}"/>
			<td th:text="${song.weeksSongWasPlayed}"/>
			<td th:text="${song.monthsSongWasPlayed}"/>
		</tr>
	</tbody>
</table>

<script th:inline="javascript" th:each="listCount : ${artistGroupList.get(0).listCounts}">
	releaseLabelsArray.push(/*[[${listCount.element}]]*/'');
	releaseSongs.push(/*[[${listCount.count}]]*/'');
	releasePercentagesSongs.push(/*[[${listCount.percentageCount}]]*/'');
	releasePlays.push(/*[[${listCount.plays}]]*/'');
	releasePercentagesPlays.push(/*[[${listCount.percentagePlays}]]*/'');
	releasePlaytime.push(/*[[${listCount.playtimeString}]]*/'');
	releasePercentagesPlaytime.push(/*[[${listCount.percentagePlaytime}]]*/'');
</script>
<script th:inline="javascript" th:each="listCount : ${artistGroupList.get(1).listCounts}">
	labelsArray.push(/*[[${listCount.element}]]*/'');
	plays.push(/*[[${listCount.plays}]]*/'');
	percentagesPlays.push(/*[[${listCount.percentagePlays}]]*/'');
	playtime.push(/*[[${listCount.playtimeString}]]*/'');
	percentagesPlaytime.push(/*[[${listCount.percentagePlaytime}]]*/'');
</script>
<div style="height:400px;" th:each="artistGroup, count : ${artistGroupList}">


	<canvas th:id="${'plays'+count.index}"></canvas>
	
	<script th:inline="javascript" th:if="${#strings.contains(artistGroup.criteria,'Release')}">
                //Release Year
				/*<![CDATA[*/
                var ctx = document.getElementById(/*[[${'plays'+count.index}]]*/'').getContext('2d');
               
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
					  labels: releaseLabelsArray,
					  datasets: [
					    {
					      label: 'Percentage of songs',
					      backgroundColor: 'rgba(55, 99, 132, 0.8)',
					      data: releasePercentagesSongs
					    },
					    {
					      label: 'Percentage of plays',
					      backgroundColor: 'rgba(255, 99, 132, 0.8)',
					      data: releasePercentagesPlays
					    },
					    {
					      label: 'Percentage of playtime',
					      backgroundColor: 'rgba(152, 255, 152, 0.8)',
					      data: releasePercentagesPlaytime
					    }
					  ]
					},
                    options:{
						responsive:true,
						maintainAspectRatio: false,
						plugins: {
					      tooltip: {
					        callbacks: {
					          label: function(context) {
								  
								var category = /*[[${artist}]]*/'';  
								var totalSongs = /*[[${artistInfo.numberOfSongs}]]*/'';
								var totalPlays = /*[[${artistInfo.totalPlays}]]*/'';
								var totalPlaytime = /*[[${artistInfo.totalPlaytime}]]*/'';
								
								var thisSongs = releaseSongs[context.dataIndex];
								var thisPlays = releasePlays[context.dataIndex];
								var thisPlaytime = releasePlaytime[context.dataIndex];
								
								var first = context.datasetIndex === 0 ? context.formattedValue+"% of all "+category+" songs were released in "+context.label:
											(context.datasetIndex === 1? context.formattedValue+"% of all "+category+" plays are from songs released in "+context.label:
											context.formattedValue+"% of all "+category+" playtime is from songs released in "+context.label);
								var second = context.datasetIndex === 0 ? "which is "+thisSongs+" songs out of "+totalSongs:
											(context.datasetIndex === 1? "which is "+thisPlays+" plays out of "+totalPlays:
											"which is "+thisPlaytime+" out of "+totalPlaytime);
					            return [first,second];
					          }
					        }
					      }
					    }
					}
					
                });

				myChart.update(); 
                /*]]>*/
                </script>
	
	
		<script th:inline="javascript" th:if="${#strings.contains(artistGroup.criteria,'Play')}">
                //Play Year
				/*<![CDATA[*/
                var ctx = document.getElementById(/*[[${'plays'+count.index}]]*/'').getContext('2d');
                
                var myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
					  labels: labelsArray,
					  datasets: [
					    {
					      label: 'Percentage of plays',
					      backgroundColor: 'rgba(255, 99, 132, 0.8)',
					      data: percentagesPlays
					    },
					    {
					      label: 'Percentage of playtime',
					      backgroundColor: 'rgba(152, 255, 152, 0.8)',
					      data: percentagesPlaytime
					    }
					  ]
					},
                    options:{
						responsive:true,
						maintainAspectRatio: false,
						plugins: {
					      tooltip: {
					        callbacks: {
					          label: function(context) {
					            var category = /*[[${artist}]]*/''; 
								var totalPlays = /*[[${artistInfo.totalPlays}]]*/'';
								var totalPlaytime = /*[[${artistInfo.totalPlaytime}]]*/'';
								
								var thisPlays = plays[context.dataIndex];
								var thisPlaytime = playtime[context.dataIndex];
								
								var first = context.datasetIndex === 0? context.formattedValue+"% of all "+category+" plays happened in "+context.label:
											context.formattedValue+"% of all "+category+" playtime happened in "+context.label;
								var second = context.datasetIndex === 0? "which is "+thisPlays+" plays out of "+totalPlays:
											"which is "+thisPlaytime+" out of "+totalPlaytime;
					            return [first,second];
					            return ['',''];
					          }
					        }
					      }
					    }
					}
					
                });

				myChart.update(); 
                /*]]>*/
                </script>
	</div>

</body>

</html>